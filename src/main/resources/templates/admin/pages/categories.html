<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Categories</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h2>Admin Categories</h2>

    <!-- 페이지 사이즈 조절 버튼 -->
    <div class="btn-group float-right mb-2">
        <button class="btn btn-secondary" onclick="changePageSize(5)" type="button">5개씩 보기</button>
        <button class="btn btn-secondary" onclick="changePageSize(10)" type="button">10개씩 보기</button>
        <button class="btn btn-secondary" onclick="changePageSize(20)" type="button">20개씩 보기</button>
    </div>

    <!-- 카테고리 목록 테이블 -->
    <table class="table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Parent Category</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <!-- 카테고리 목록 루프 -->
        <tr th:each="category : ${categories}">
            <td th:text="${category.id}"></td>
            <td th:text="${category.name}"></td>
            <td>
                <!-- 부모 카테고리 -->
                <ul th:if="${category.parentCategory}">
                    <li th:each="entry : ${category.parentCategory.entrySet()}" th:text="${entry.value}"></li>
                </ul>
            </td>
            <td>
                <!-- 수정 링크 -->
                <form method="post" style="display: inline;" th:action="@{'/admin/category/' + ${category.id}}">
                    <input name="_method" type="hidden" value="put">
                    <button class="btn btn-primary" type="submit">Edit</button>
                </form>
                <!-- 삭제 버튼 -->
                <button class="btn btn-danger" onclick="deleteCategory(/*[[${category.id}]]*/)" type="button">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- 페이징 -->
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item" th:classappend="${categoryPages.first} ? 'disabled' : ''">
                <a class="page-link" tabindex="-1"
                   th:href="@{'/admin/category?pageNo=0&pageSize=' + ${categoryPages.size}}">First</a>
            </li>
            <li class="page-item" th:classappend="${categoryPages.first} ? 'disabled' : ''">
                <a class="page-link"
                   tabindex="-1"
                   th:href="@{'/admin/category?pageNo=' + (${categoryPages.number - 1}) + '&pageSize=' + ${categoryPages.size}}">Previous</a>
            </li>
            <li class="page-item" th:classappend="${categoryPages.last} ? 'disabled' : ''">
                <a class="page-link"
                   th:href="@{'/admin/category?pageNo=' + (${categoryPages.number + 1}) + '&pageSize=' + ${categoryPages.size}}">Next</a>
            </li>
            <li class="page-item" th:classappend="${categoryPages.last} ? 'disabled' : ''">
                <a class="page-link"
                   th:href="@{'/admin/category?pageNo=' + (${categoryPages.totalPages - 1}) + '&pageSize=' + ${categoryPages.size}}">Last</a>
            </li>
        </ul>
    </nav>

    <!-- 새 카테고리 추가 폼 -->
    <form method="post" th:action="@{/admin/category}">
        <div class="form-group">
            <label for="name">새 카테고리 이름:</label>
            <input class="form-control" id="name" name="name" required type="text">
        </div>
        <div class="form-group">
            <label for="parentCategoryId">새 카테고리의 상위 카테고리 ID:</label>
            <input class="form-control" id="parentCategoryId" name="parentCategoryId" type="number">
        </div>
        <button class="btn btn-primary" type="submit">Add Category</button>
    </form>
</div>

<script th:inline="javascript">
    /* 페이지 사이즈 변경 함수 */
    function changePageSize(size) {
        const url = '/admin/category?pageNo=0&pageSize=' + size;
        window.location.href = url;
    }

    function deleteCategory(id) {
        if (confirm('정말 이 카테고리를 삭제하시겠습니까?')) {
            const url = '/admin/category/' + id;
            fetch(url, {method: 'DELETE'})
                .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // 삭제가 성공적으로 처리된 경우의 로직
                console.log('Category with ID ' + id + ' deleted successfully.');
                // 여기서 필요한 UI 업데이트 등을 수행할 수 있습니다.
            })
                .catch(error => {
                    // 삭제 요청 실패 시 오류 처리 로직
                    console.error('Error deleting category:', error);
                });
        }
    }
</script>


</body>
</html>
