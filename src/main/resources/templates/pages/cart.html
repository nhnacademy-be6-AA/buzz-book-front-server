<head>
  <script>
    function calculateTotal() {
      let total = 0;
      document.querySelectorAll('.total-price').forEach(function(element) {
        total += parseFloat(element.innerText);
      });
      document.getElementById('grand-total').innerText = total;
    }

    function updateTotalPrice(element) {
      const row = element.closest('tr');
      const quantity = parseFloat(row.querySelector('.quantity-input').value);
      const price = parseFloat(row.querySelector('.price').innerText);
      const totalPriceElement = row.querySelector('.total-price');
      const totalPrice = quantity * price;
      totalPriceElement.innerText = totalPrice;

      calculateTotal();
    }

    document.addEventListener('DOMContentLoaded', function() {
      calculateTotal();
    });
  </script>
</head>

<body th:fragment="cartPageFragment">
<!-- Spinner Start -->
<div
    id="spinner"
    class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50 d-flex align-items-center justify-content-center"
>
  <div class="spinner-grow text-primary" role="status"></div>
</div>
<!-- Spinner End -->

<!-- Navbar Start -->
<div th:replace="~{components/navbar :: navbarFragment}"></div>
<!-- Navbar End -->

<!-- Modal Search Start -->
<div
    class="modal fade"
    id="searchModal"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
>
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content rounded-0">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Search by keyword</h5>
        <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
        ></button>
      </div>
      <div class="modal-body d-flex align-items-center">
        <div class="input-group w-75 mx-auto d-flex">
          <input
              type="search"
              class="form-control p-3"
              placeholder="keywords"
              aria-describedby="search-icon-1"
          />
          <span id="search-icon-1" class="input-group-text p-3"
          ><i class="fa fa-search"></i
          ></span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal Search End -->

<!-- Cart Page Start -->
<h1>Shopping Cart</h1>

<div th:if="${!cart.cartDetailList().isEmpty()}">
  <table>
    <thead>
    <tr>
      <th>Thumbnail</th>
      <th>Product</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Total</th>
      <th>제거</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="detail : ${cart.cartDetailList}">
      <td><img th:src="@{${detail.thumbnailPath}}" alt="Product Thumbnail" width="50"></td>
      <td th:text="${detail.productName}">Product Name</td>
      <td>
        <form th:action="@{/cart/update}" method="post">
          <input type="hidden" name="id" th:value="${detail.id}" />
          <input type="number" name="quantity" th:value="${detail.quantity}" min="1" class="quantity-input" oninput="updateTotalPrice(this)" />
          <button type="submit">Update</button>
        </form>
      </td>
      <td class="price" th:text="${detail.price}">Price</td>
      <td class="total-price" th:text="${detail.quantity * detail.price}">Total</td>
      <td>
        <form th:action="@{/cart/delete}" method="get">
          <input type="hidden" name="detailId" th:value="${detail.id}" />
          <button type="submit">상품 제거</button>
        </form>
      </td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
      <td colspan="3">Grand Total</td>
      <td id="grand-total">0</td>
      <td></td>
      <td></td>
    </tr>
    </tfoot>
  </table>
</div>
<div th:if="${cart.cartDetailList.isEmpty()}">
  <p>Your cart is empty.</p>
</div>
<!-- Cart Page End -->

<!-- Footer Start -->
<footer th:replace="~{components/footer :: footerFragment}"></footer>
<!-- Footer End -->

<!-- Back to Top -->
<a
    href="#"
    class="btn btn-primary border-3 border-primary rounded-circle back-to-top"
><i class="fa fa-arrow-up"></i
></a>

</body>
