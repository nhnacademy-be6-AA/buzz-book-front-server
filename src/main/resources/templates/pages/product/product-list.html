<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product List</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body th:fragment="productListFragment('products','productPage','query','productType')">
<div class="container">

  <style>
    .product-image img {
      max-width: 150px;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 10px 8px rgba(0, 0, 0, 0.1);
    }

    .product-actions button {
      margin-top: 5px;
    }

    .pagination {
      flex-wrap: nowrap;
    }
  </style>

  <header class="my-4">
    <h1>buzz-book</h1>
    <div class="row mb-3">
      <div class="col-md-4">
        <select id="productTypeSelect" class="form-select">
          <option value="" th:selected="${productType == null}">---선택---</option>
          <option th:each="type : ${stockStatusOptions}" th:value="${type}" th:text="${type}" th:selected="${type == productType}"></option>
        </select>
      </div>
      <div class="col-md-4">
        <form id="searchForm" action="/product" method="get">
          <input type="text" id="searchQuery" name="query" class="form-control" placeholder="상품 정보를 입력해주세요" th:value="${query}">
        </form>
      </div>
      <div class="col-md-4">
        <button class="btn btn-primary" onclick="document.getElementById('searchForm').submit()">검색</button>
        <button class="btn btn-secondary" onclick="clearFilters()">필터 해제</button>
      </div>
    </div>
  </header>

  <nav class="mb-4">
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a class="nav-link" href="#">인기상품</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">국내도서</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">굿즈</a>
      </li>
    </ul>
  </nav>

  <div class="list-group">
    <div th:each="product : ${productPage.content}" class="list-group-item">
      <div class="row">
        <div class="col-md-2 product-image">
          <img th:src="${product.thumbnailPath}" alt="Product Image">
        </div>
        <div class="col-md-7">
          <h5>
            <a th:href="@{/product/{id}(id=${product.id})}" th:text="${product.productName}">Product Title</a>
          </h5>
          <p th:text="${product.description}">상품설명</p>
          <p class="font-weight-bold" th:text="${product.price}">Product Price</p>
        </div>
        <div class="col-md-3 product-actions">
          <button class="btn btn-outline-primary btn-sm" th:onclick="'location.href=\'/cart/add/' + ${product.id} + '\''">장바구니</button>
          <button class="btn btn-primary btn-sm" th:onclick="'location.href=\'/product/' + ${product.id} + '\''">바로구매</button>
          <button class="btn btn-secondary btn-sm">보관함</button>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-center my-4">
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <li class="page-item" th:classappend="${!productPage.hasPrevious()} ? 'disabled'">
          <a class="page-link" th:href="@{/product(page=${productPage.number - 1}, query=${query})}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item" th:each="I : ${#numbers.sequence(1, productPage.totalPages)}" th:classappend="${I == productPage.number + 1} ? 'active'">
          <a class="page-link" th:href="@{/product(page=${I - 1}, query=${query})}" th:text="${I}"></a>
        </li>
        <li class="page-item" th:classappend="${!productPage.hasNext()} ? 'disabled'">
          <a class="page-link" th:href="@{/product(page=${productPage.number + 1}, query=${query})}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<script>
  function clearFilters() {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('query');
    window.location.search = urlParams.toString();
  }

  function addToCart(productId) {
    // Create request payload
    const data = {
      productId: productId
    };

    // Send POST request
    fetch('/cart/detail', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
            .then(response => {
              if (response.ok) {
                alert('장바구니에 추가되었습니다.');
              } else {
                alert('장바구니 추가 실패.');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('장바구니 추가 중 오류가 발생했습니다.');
            });
  }
</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>